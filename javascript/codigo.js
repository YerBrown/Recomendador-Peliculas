const PELICULAS = [
  {
    adult: false,
    backdrop_path: "/7h6TqPB3ESmjuVbxCxAeB1c9OB1.jpg",
    genre_ids: [27, 18, 878],
    id: 933260,
    original_language: "en",
    original_title: "The Substance",
    overview:
      '"Tú, pero mejor en todos los sentidos". Esa es la promesa de La Sustancia, un producto revolucionario basado en la división celular, que crea un alter ego más joven, más bello, más perfecto.',
    popularity: 4964.05,
    poster_path: "/4cJyrYA7I29QabrQ0S89N1iWUV2.jpg",
    release_date: "2024-09-07",
    title: "La Sustancia",
    video: false,
    vote_average: 7.4,
    vote_count: 510,
  },
  {
    adult: false,
    backdrop_path: "/yDHYTfA3R0jFYba16jBB1ef8oIt.jpg",
    genre_ids: [28, 35, 878],
    id: 533535,
    original_language: "en",
    original_title: "Deadpool & Wolverine",
    overview:
      "Un apático Wade Wilson se afana en la vida civil tras dejar atrás sus días como Deadpool, un mercenario moralmente flexible. Pero cuando su mundo natal se enfrenta a una amenaza existencial, Wade debe volver a vestirse a regañadientes con un Lobezno aún más reacio a ayudar.",
    popularity: 2844.462,
    poster_path: "/9TFSqghEHrlBMRR63yTx80Orxva.jpg",
    release_date: "2024-07-24",
    title: "Deadpool y Lobezno",
    video: false,
    vote_average: 7.713,
    vote_count: 4476,
  },
  {
    adult: false,
    backdrop_path: "/xi1VSt3DtkevUmzCx2mNlCoDe74.jpg",
    genre_ids: [35, 14, 27],
    id: 917496,
    original_language: "en",
    original_title: "Beetlejuice Beetlejuice",
    overview:
      "Tras una inesperada tragedia familiar, tres generaciones de la familia Deetz regresan a Winter River. La vida de Lydia, todavía atormentada por Bitelchús, da un vuelco cuando su rebelde hija adolescente, Astrid, descubre la misteriosa maqueta de la ciudad en el desván y el portal al Más Allá se abre accidentalmente. Con los problemas que se avecinan en ambos reinos, es sólo cuestión de tiempo que alguien diga el nombre de Bitelchús tres veces y el travieso demonio regrese para desatar su propio caos.",
    popularity: 1986.658,
    poster_path: "/kWJw7dCWHcfMLr0irTHAPIKrJ4I.jpg",
    release_date: "2024-09-04",
    title: "Bitelchús Bitelchús",
    video: false,
    vote_average: 7.204,
    vote_count: 1289,
  },
  {
    adult: false,
    backdrop_path: "/3m0j3hCS8kMAaP9El6Vy5Lqnyft.jpg",
    genre_ids: [878, 53, 18, 27],
    id: 1125510,
    original_language: "es",
    original_title: "El hoyo 2",
    overview:
      "Un misterioso líder ha impuesto su ley en un brutal sistema de celdas verticales, pero la llegada de una residente desafía su dudoso método de distribución de comida.",
    popularity: 1948.952,
    poster_path: "/8cnfdskwEmS1HZhenEVYt9P0IYa.jpg",
    release_date: "2024-09-27",
    title: "El hoyo 2",
    video: false,
    vote_average: 5.7,
    vote_count: 545,
  },
  {
    adult: false,
    backdrop_path: "/v9acaWVVFdZT5yAU7J2QjwfhXyD.jpg",
    genre_ids: [16, 878, 10751],
    id: 1184918,
    original_language: "en",
    original_title: "The Wild Robot",
    overview:
      "Una robot (la unidad ROZZUM 7134 o «Roz») ha naufragado en una isla deshabitada y deberá aprender a adaptarse al duro entorno, forjando poco a poco relaciones con la fauna local y convirtiéndose en madre adoptiva de una cría de ganso huérfana.",
    popularity: 2282.501,
    poster_path: "/sDoXpaKZmrzCSJH63zZvQQ9A7VK.jpg",
    release_date: "2024-09-12",
    title: "Robot salvaje",
    video: false,
    vote_average: 8.562,
    vote_count: 390,
  },
  {
    adult: false,
    backdrop_path: "/xlkclSE4aq7r3JsFIJRgs21zUew.jpg",
    genre_ids: [27, 53],
    id: 1034541,
    original_language: "en",
    original_title: "Terrifier 3",
    overview: 'Secuela de "Terrifier 2", ambientada en el periodo navideño.',
    popularity: 1576.845,
    poster_path: "/5eECVdOWwbsUARVxLA7ENyBYx3H.jpg",
    release_date: "2024-10-09",
    title: "Terrifier 3",
    video: false,
    vote_average: 7,
    vote_count: 57,
  },
  {
    adult: false,
    backdrop_path: "/lgkPzcOSnTvjeMnuFzozRO5HHw1.jpg",
    genre_ids: [16, 10751, 35, 28],
    id: 519182,
    original_language: "en",
    original_title: "Despicable Me 4",
    overview:
      "Gru, Lucy y las niñas -Margo, Edith y Agnes- dan la bienvenida a un nuevo miembro en la familia: Gru Junior, que parece llegar con el propósito de ser un suplicio para su padre. Gru tendrá que enfrentarse en esta ocasión a su nueva némesis Maxime Le Mal y su sofisticada y malévola novia Valentina, lo que obligará a la familia a tener que darse a la fuga. Cuarta entrega de 'Gru, mi villano favorito'.",
    popularity: 1339.874,
    poster_path: "/kqph8UWNOoYgTjYnkAx8dRlLLCq.jpg",
    release_date: "2024-06-20",
    title: "Gru 4. Mi villano favorito",
    video: false,
    vote_average: 7.133,
    vote_count: 1977,
  },
  {
    adult: false,
    backdrop_path: "/g1z1ZvYKcmk9EnVOTYXR6vkNjkZ.jpg",
    genre_ids: [14, 27, 28],
    id: 1087822,
    original_language: "en",
    original_title: "Hellboy: The Crooked Man",
    overview:
      "Sigue a Hellboy y a un agente novato de BPRD mientras quedan varados en la zona rural de los Apalaches de la década de 1950. Descubren una pequeña comunidad embrujada por brujas, dirigida por el Hombre Torcido.",
    popularity: 1395.785,
    poster_path: "/ExFaxmvlGxBmUBVKv9ey94fNyy.jpg",
    release_date: "2024-08-29",
    title: "Hellboy: The Crooked Man",
    video: false,
    vote_average: 4.8,
    vote_count: 112,
  },
];
const GENEROS = [
  {
    id: 28,
    name: "Acción",
  },
  {
    id: 12,
    name: "Aventura",
  },
  {
    id: 16,
    name: "Animación",
  },
  {
    id: 35,
    name: "Comedia",
  },
  {
    id: 80,
    name: "Crimen",
  },
  {
    id: 99,
    name: "Documental",
  },
  {
    id: 18,
    name: "Drama",
  },
  {
    id: 10751,
    name: "Familia",
  },
  {
    id: 14,
    name: "Fantasía",
  },
  {
    id: 36,
    name: "Historia",
  },
  {
    id: 27,
    name: "Terror",
  },
  {
    id: 10402,
    name: "Música",
  },
  {
    id: 9648,
    name: "Misterio",
  },
  {
    id: 10749,
    name: "Romance",
  },
  {
    id: 878,
    name: "Ciencia ficción",
  },
  {
    id: 10770,
    name: "Película de TV",
  },
  {
    id: 53,
    name: "Suspense",
  },
  {
    id: 10752,
    name: "Bélica",
  },
  {
    id: 37,
    name: "Western",
  },
];
const mediaLink = "https://www.themoviedb.org/t/p/w1280/";

function getGenreById(id) {
  return GENEROS.find((genero) => genero.id == id).name;
}

function getFilmById(id) {
  return PELICULAS.find((pelicula) => pelicula.id == id);
}
function getFavMovieCard(film) {
  const cardParent = document.createElement("div");
  cardParent.classList.add("fav-movie");
  cardParent.setAttribute("film-id", film.id);
  cardParent.addEventListener('click', function(){
    openMoreInfoPopup(this.getAttribute("film-id"));
  });
  const poster = document.createElement("img");
  poster.src = mediaLink + film.poster_path;
  poster.alt = "poster de " + film.title;

  cardParent.appendChild(poster);

  return cardParent;
}
function renderAllFilms(films) {
  const favMoviesGrid = document.getElementById("fav-grid");
  for (const film of films) {
    const movieCardNode = getFavMovieCard(film);
    favMoviesGrid.appendChild(movieCardNode);
  }
}

function openMoreInfoPopup(filmID) {
  const film = getFilmById(filmID);
  if (film == null || film == {}) return;
  const backdropPath = mediaLink + film.backdrop_path;
  const posterPath = mediaLink + film.poster_path;
  const main = document.getElementsByTagName("main")[0];
  //Crear
  const popupPadre = document.createElement("section");
  popupPadre.id = "more-info";
  const popupContent = document.createElement("div");
  popupContent.id = "my-favs-card";

  const background = document.createElement("div");
  background.id = "popup-background";
  background.style.backgroundImage = `url(${backdropPath})`;
  const backgroundFilter = document.createElement("div");
  backgroundFilter.id = "popup-background-filter";

  const leftSide = document.createElement("div");
  leftSide.id = "left-portrait";
  const rightSide = document.createElement("div");
  rightSide.id = "right-info";

  const poster = document.createElement("img");
  poster.src = posterPath;
  poster.alt = "portada";
  leftSide.appendChild(poster);

  const filmTitle = document.createElement("h3");
  filmTitle.textContent = `${film.title}`;

  const filmInfo = document.createElement("p");
  let genres = film.genre_ids.map((id) => getGenreById(id));

  genres = genres.join(", ");
  filmInfo.textContent = `${film.release_date} | ${genres}`;

  const close = document.createElement("div");
  close.id = "close";
  const closeButton = document.createElement("button");
  closeButton.id = "close-button";
  closeButton.textContent = "Cerrar";
  closeButton.addEventListener("click", closeMoreInfoPopup);
  close.appendChild(closeButton);
  rightSide.append(close, filmTitle, filmInfo);

  popupContent.append(leftSide, rightSide, background, backgroundFilter);
  popupPadre.appendChild(popupContent);
  main.appendChild(popupPadre);
}

function closeMoreInfoPopup() {
  const popupParent = document.getElementById("more-info");
  popupParent.remove();
}
// openMoreInfoPopup(PELICULAS[5].id);
renderAllFilms(PELICULAS);
// import FavMovie from "./favMovieCard.js";